<script>
var script = document.createElement("script");
script.type = "text/javascript";
script.src = "https://checkout.stripe.com/checkout.js";
script.onload = function () {
  var handler = StripeCheckout.configure({
      key: '<%= meta[:publishable_key] %>',
      //get a publishable key that we put in editor depending on environment: production or development
      locale: 'auto',
      //handle translation
      name: "Stripe Checkout",
      description: "Add your credit card information",
      email: "<%= current_user.try(:email) %>",
      panelLabel: "Add payment method",
      allowRememberMe: false,
      token: function (token) {
          var form = document.getElementById('<%= form_id || "billing-create-payment-method" %>');
          //we will create element with this id in the next step
          var hiddenInput = document.createElement('input');
          hiddenInput.setAttribute('type', 'hidden');
          hiddenInput.setAttribute('name', 'payment_nonce');
          hiddenInput.setAttribute('value', token.id);
          //creating an <input type="hidden" name="stripeToken" value="<id>"/>. We will need this information in the next steps to link a user to his card
          form.appendChild(hiddenInput);
          //adding this input when we use a form.
          form.submit();
      }
  });

  
  handler.open();
  
  window.addEventListener('popstate', function() {
      handler.close();
  });
}
document.getElementsByTagName("head")[0].appendChild(script);

</script>
